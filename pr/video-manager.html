<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìπ Portfolio Video Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            padding: 40px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-links {
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .nav-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 600;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #764ba2;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }

        .header .emoji {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .radio-option {
            flex: 1;
            position: relative;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option label {
            display: block;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .radio-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .radio-option label:hover {
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 8px 15px;
            font-size: 12px;
        }

        /* Video Entry Card */
        .video-entries-container {
            margin-top: 20px;
        }

        .video-entry {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }

        .video-entry.valid {
            border-color: #28a745;
            background: #f8fff8;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .video-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .video-entry-number {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        .remove-video-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .remove-video-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .video-entry-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .video-entry-grid .form-group {
            margin-bottom: 0;
        }

        .video-entry-grid .form-group.full-width {
            grid-column: 1 / -1;
        }

        .thumbnail-preview {
            margin-top: 10px;
            display: none;
        }

        .thumbnail-preview.show {
            display: block;
        }

        .thumbnail-preview img {
            width: 100%;
            max-width: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Add More Button */
        .add-video-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 20px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            background: transparent;
            color: #667eea;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .add-video-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
            color: #764ba2;
        }

        .add-video-btn .plus-icon {
            font-size: 24px;
            font-weight: bold;
        }

        /* Category Field (for longform) */
        .category-field {
            display: none;
        }

        .category-field.show {
            display: block;
        }

        /* Success/Error Messages */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .helper-text {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* Progress */
        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #667eea;
        }

        /* Video Count Badge */
        .video-count-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }

        /* Summary Section */
        .summary-section {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }

        .summary-section.show {
            display: block;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 600px) {
            .video-entry-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="emoji">üìπ</div>
            <h1>Portfolio Video Manager</h1>
            <p>Add multiple videos to your portfolio at once</p>
            <div class="nav-links">
                <a href="/">‚ûï Add Videos</a>
                <a href="/manage-videos.html">üóëÔ∏è Manage Videos</a>
            </div>
        </div>

        <form id="videoForm">
            <!-- Category Selection -->
            <div class="form-group">
                <label>Video Category <span class="required">*</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="longform" name="category" value="longform" checked>
                        <label for="longform">
                            üé¨<br>Long-form<br>
                            <small style="font-weight: normal; opacity: 0.8;">Featured Projects</small>
                        </label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="shortform" name="category" value="shortform">
                        <label for="shortform">
                            üì±<br>Short-form<br>
                            <small style="font-weight: normal; opacity: 0.8;">Featured Reels (Carousel)</small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Video Entries Container -->
            <div class="video-entries-container" id="videoEntriesContainer">
                <!-- Video entries will be added here dynamically -->
            </div>

            <!-- Add More Video Button -->
            <button type="button" class="add-video-btn" id="addVideoBtn">
                <span class="plus-icon">+</span>
                <span>Add Another Video</span>
            </button>

            <!-- Summary Section -->
            <div class="summary-section" id="summarySection">
                <h4 style="margin-bottom: 10px;">üìã Upload Summary</h4>
                <div id="summaryContent"></div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary" id="submitBtn">
                ‚ú® Add Videos to Portfolio
            </button>

            <!-- Progress -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <p class="progress-text" id="progressText">Preparing...</p>
            </div>
        </form>

        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>
    </div>

    <script>
        let videoCount = 0;
        const videoEntries = [];

        // Initialize with one video entry
        document.addEventListener('DOMContentLoaded', () => {
            addVideoEntry();
            updateCategoryFields();
        });

        // Category change handler
        const categoryRadios = document.querySelectorAll('input[name="category"]');
        categoryRadios.forEach(radio => {
            radio.addEventListener('change', updateCategoryFields);
        });

        function updateCategoryFields() {
            const isLongform = document.querySelector('input[name="category"]:checked').value === 'longform';
            document.querySelectorAll('.category-field').forEach(field => {
                if (isLongform) {
                    field.classList.add('show');
                } else {
                    field.classList.remove('show');
                }
            });
            updateSummary();
        }

        // Add video entry
        document.getElementById('addVideoBtn').addEventListener('click', addVideoEntry);

        function addVideoEntry() {
            videoCount++;
            const entryId = videoCount;
            
            const isLongform = document.querySelector('input[name="category"]:checked').value === 'longform';
            
            const entryHTML = `
                <div class="video-entry" id="videoEntry${entryId}" data-entry-id="${entryId}">
                    <div class="video-entry-header">
                        <span class="video-entry-number">Video #${entryId}</span>
                        ${videoCount > 1 ? `<button type="button" class="remove-video-btn" onclick="removeVideoEntry(${entryId})">‚úï Remove</button>` : ''}
                    </div>
                    <div class="video-entry-grid">
                        <div class="form-group">
                            <label for="title${entryId}">Video Title <span class="required">*</span></label>
                            <input 
                                type="text" 
                                id="title${entryId}" 
                                class="video-title-input"
                                placeholder="e.g., Amazing Travel Video"
                                data-entry-id="${entryId}"
                                oninput="validateEntry(${entryId})"
                            >
                        </div>
                        <div class="form-group">
                            <label for="videoUrl${entryId}">Streamable URL <span class="required">*</span></label>
                            <input 
                                type="text" 
                                id="videoUrl${entryId}" 
                                class="video-url-input"
                                placeholder="https://streamable.com/abc123"
                                data-entry-id="${entryId}"
                                oninput="handleUrlInput(${entryId})"
                            >
                            <p class="helper-text">Paste your Streamable video URL</p>
                        </div>
                        <div class="form-group category-field ${isLongform ? 'show' : ''}">
                            <label for="videoCategory${entryId}">Project Type <span class="required">*</span></label>
                            <select id="videoCategory${entryId}" class="video-category-select" data-entry-id="${entryId}" onchange="validateEntry(${entryId})">
                                <option value="">Select category...</option>
                                <option value="Spec Work">Spec Work</option>
                                <option value="Motion Graphics">Motion Graphics</option>
                                <option value="Style Recreation">Style Recreation</option>
                                <option value="Cinematic Edit">Cinematic Edit</option>
                                <option value="Documentary">Documentary</option>
                                <option value="Commercial">Commercial</option>
                                <option value="Music Video">Music Video</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="thumbnail-preview" id="thumbnailPreview${entryId}">
                                <label>Thumbnail Preview</label>
                                <img id="thumbnailImg${entryId}" alt="Video thumbnail">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('videoEntriesContainer').insertAdjacentHTML('beforeend', entryHTML);
            videoEntries.push(entryId);
            updateSummary();
        }

        function removeVideoEntry(entryId) {
            const entry = document.getElementById(`videoEntry${entryId}`);
            if (entry) {
                entry.remove();
                const index = videoEntries.indexOf(entryId);
                if (index > -1) {
                    videoEntries.splice(index, 1);
                }
                renumberEntries();
                updateSummary();
            }
        }

        function renumberEntries() {
            const entries = document.querySelectorAll('.video-entry');
            entries.forEach((entry, index) => {
                const numberSpan = entry.querySelector('.video-entry-number');
                if (numberSpan) {
                    numberSpan.textContent = `Video #${index + 1}`;
                }
            });
        }

        function handleUrlInput(entryId) {
            const urlInput = document.getElementById(`videoUrl${entryId}`);
            const thumbnailPreview = document.getElementById(`thumbnailPreview${entryId}`);
            const thumbnailImg = document.getElementById(`thumbnailImg${entryId}`);
            
            const url = urlInput.value.trim();
            const match = url.match(/streamable\.com\/([a-zA-Z0-9]+)/);
            
            if (match) {
                const embedId = match[1];
                const thumbnailUrl = `https://cdn-cf-east.streamable.com/image/${embedId}.jpg`;
                thumbnailImg.src = thumbnailUrl;
                thumbnailPreview.classList.add('show');
            } else {
                thumbnailPreview.classList.remove('show');
            }
            
            validateEntry(entryId);
        }

        function validateEntry(entryId) {
            const entry = document.getElementById(`videoEntry${entryId}`);
            const title = document.getElementById(`title${entryId}`).value.trim();
            const url = document.getElementById(`videoUrl${entryId}`).value.trim();
            const isLongform = document.querySelector('input[name="category"]:checked').value === 'longform';
            const category = document.getElementById(`videoCategory${entryId}`)?.value;
            
            const urlMatch = url.match(/streamable\.com\/([a-zA-Z0-9]+)/);
            
            let isValid = title && urlMatch;
            if (isLongform) {
                isValid = isValid && category;
            }
            
            if (isValid) {
                entry.classList.add('valid');
            } else {
                entry.classList.remove('valid');
            }
            
            updateSummary();
        }

        function updateSummary() {
            const summarySection = document.getElementById('summarySection');
            const summaryContent = document.getElementById('summaryContent');
            const isLongform = document.querySelector('input[name="category"]:checked').value === 'longform';
            
            let validCount = 0;
            let summaryHTML = '';
            
            videoEntries.forEach((entryId, index) => {
                const title = document.getElementById(`title${entryId}`)?.value.trim() || '';
                const url = document.getElementById(`videoUrl${entryId}`)?.value.trim() || '';
                const urlMatch = url.match(/streamable\.com\/([a-zA-Z0-9]+)/);
                
                let isValid = title && urlMatch;
                if (isLongform) {
                    const category = document.getElementById(`videoCategory${entryId}`)?.value;
                    isValid = isValid && category;
                }
                
                if (isValid) {
                    validCount++;
                    summaryHTML += `
                        <div class="summary-item">
                            <span>${index + 1}. ${title}</span>
                            <span style="color: #28a745;">‚úì Ready</span>
                        </div>
                    `;
                } else if (title || url) {
                    summaryHTML += `
                        <div class="summary-item">
                            <span>${index + 1}. ${title || 'Untitled'}</span>
                            <span style="color: #dc3545;">‚ö† Incomplete</span>
                        </div>
                    `;
                }
            });
            
            if (validCount > 0) {
                summaryContent.innerHTML = summaryHTML;
                summarySection.classList.add('show');
                document.getElementById('submitBtn').textContent = `‚ú® Add ${validCount} Video${validCount > 1 ? 's' : ''} to Portfolio`;
            } else {
                summarySection.classList.remove('show');
                document.getElementById('submitBtn').textContent = '‚ú® Add Videos to Portfolio';
            }
        }

        // Form submission
        document.getElementById('videoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const submitBtn = document.getElementById('submitBtn');
            
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');
            
            const category = document.querySelector('input[name="category"]:checked').value;
            const isLongform = category === 'longform';
            
            // Collect valid videos
            const videosToAdd = [];
            
            videoEntries.forEach(entryId => {
                const title = document.getElementById(`title${entryId}`)?.value.trim();
                const url = document.getElementById(`videoUrl${entryId}`)?.value.trim();
                const videoCategory = document.getElementById(`videoCategory${entryId}`)?.value;
                
                const urlMatch = url?.match(/streamable\.com\/([a-zA-Z0-9]+)/);
                
                if (title && urlMatch) {
                    const embedId = urlMatch[1];
                    const thumbnail = `https://cdn-cf-east.streamable.com/image/${embedId}.jpg`;
                    
                    if (!isLongform || (isLongform && videoCategory)) {
                        videosToAdd.push({
                            title,
                            videoUrl: url,
                            embedId,
                            thumbnail,
                            videoCategory: videoCategory || null,
                            category
                        });
                    }
                }
            });
            
            if (videosToAdd.length === 0) {
                showError('Please fill in at least one valid video entry.');
                return;
            }
            
            // Start upload process
            submitBtn.disabled = true;
            progressContainer.classList.add('show');
            
            let successCount = 0;
            let failedVideos = [];
            
            for (let i = 0; i < videosToAdd.length; i++) {
                const video = videosToAdd[i];
                const progress = ((i + 1) / videosToAdd.length) * 100;
                
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `Adding video ${i + 1} of ${videosToAdd.length}: ${video.title}...`;
                
                try {
                    const response = await fetch('/add-video', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(video)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                    } else {
                        failedVideos.push({ title: video.title, error: result.error });
                    }
                } catch (error) {
                    failedVideos.push({ title: video.title, error: error.message });
                }
                
                // Small delay between requests
                if (i < videosToAdd.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            progressContainer.classList.remove('show');
            submitBtn.disabled = false;
            
            if (successCount > 0) {
                let successHTML = `
                    <h4>üéâ Success!</h4>
                    <p><strong>${successCount} video${successCount > 1 ? 's' : ''} added successfully!</strong></p>
                    <p style="margin-top: 10px;">‚úÖ Videos added to Work.tsx</p>
                    <p>‚úÖ Changes committed to Git</p>
                    <p>‚úÖ Pushed to GitHub automatically</p>
                `;
                
                if (failedVideos.length > 0) {
                    successHTML += `
                        <p style="margin-top: 10px; color: #856404;">‚ö†Ô∏è ${failedVideos.length} video${failedVideos.length > 1 ? 's' : ''} failed:</p>
                        <ul style="margin-left: 20px;">
                            ${failedVideos.map(v => `<li>${v.title}: ${v.error}</li>`).join('')}
                        </ul>
                    `;
                }
                
                successHTML += `
                    <p style="margin-top: 15px; padding: 10px; background: #c3e6cb; border-radius: 5px;">
                        üöÄ Your portfolio will update in a few minutes after GitHub Pages rebuilds!
                    </p>
                `;
                
                successMessage.innerHTML = successHTML;
                successMessage.classList.add('show');
                
                // Reset form
                document.getElementById('videoEntriesContainer').innerHTML = '';
                videoEntries.length = 0;
                videoCount = 0;
                addVideoEntry();
                updateCategoryFields();
                
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                showError('Failed to add videos. Please check the server is running.');
            }
        });

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = '‚ùå ' + message;
            errorMessage.classList.add('show');
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
